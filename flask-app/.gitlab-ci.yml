stages:
 - build
 - test

variables:
 IMAGE_NAME: flask-app

build:
 stage: build
 image: docker:latest
 services:
    - docker:dind
 script:
  - echo "Building Docker image from flask-app/Dockerfile......"
  - docker build -f flask-app/Dockerfile -t $IMAGE_NAME flask-app
  - docker images

test:
 stage: test
 image: python:3.10-slim
 script:
  - echo "Testing Flask app..."
  # install from the requirements file inside flask-app directory
  - pip install -r flask-app/requirements.txt
  # run unit tests that live in flask-app (adjust if your tests are elsewhere)
  - python -m unittest discover flask-app || echo "No tests yet - skipping"